<html>
<head>
<title>RPi Home Controller</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css">
<script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
<style type="text/css">
.ui-header .ui-title {
    margin-right: 10%;
    margin-left: 10%;
}
</style>
<script type="text/javascript">

function change_switch(switch_name, switch_value) {
    $.ajax({
        url: '/switch/' + switch_name,
        type: 'PUT',
        data: "value="+switch_value,
        success: function(data) {
            //alert("Switch " + switch_name + " was set to " + switch_value);
        }
    });
}

function set_switch_ui_value(switch_ui_id, on_or_off) {
    alert("Setting ui for "+switch_ui_id+" to "+on_or_off);
    $(switch_ui_id).val(on_or_off);
//    $(switch_ui_id+" option").filter(function() {
//        return $(this).text() == on_or_off; 
//    }).prop('selected', true);
}

function refresh_switches() {
    $.get("/switch/list", function(data) {
        for (var key in data) {
            set_switch_ui_value("#switch"+key, data[key]);
        }
    });
}

$(function() {
    $("#switch1").bind("change", function(event, ui) {
        var new_value = $(this).attr('value');
        change_switch('1', new_value);
    });
    $("#switch2").bind("change", function(event, ui) {
        var new_value = $(this).attr('value');
        change_switch('2', new_value);
    });
    $("#switch3").bind("change", function(event, ui) {
        var new_value = $(this).attr('value');
        change_switch('3', new_value);
    });

    $("#refresh_button").bind("click", function(event, ui) {
        refresh_switches();
    });

    refresh_switches();
});


</script>
</head>
<body>

<div data-role="page">
    <div data-role="header" data-position="fixed">
        <h2>RPi Home Controller</h2>
        <a href="#" id="refresh_button" data-role="button" data-icon="refresh" class="ui-btn-right" data-iconpos="notext">Refresh</a>
    </div>

    <div data-role="content">
        <div data-role="fieldcontain">
            <label for="switch1">Switch 1</label>
            <select name="switch1" id="switch1" data-role="slider">
            <option value="on">On</option>
            <option value="off">Off</option>
            </select>
        </div>
        <div data-role="fieldcontain">
            <label for="switch2">Switch 2</label>
            <select name="switch2" id="switch2" data-role="slider">
            <option value="on">On</option>
            <option value="off">Off</option>
            </select>
        </div>
        <div data-role="fieldcontain">
            <label for="switch3">Switch 3</label>
            <select name="switch3" id="switch3" data-role="slider">
            <option value="on">On</option>
            <option value="off">Off</option>
            </select>
        </div>
    </div>

    <div data-role="footer" data-position="fixed">&nbsp;</div>
</div>

</body>
</html>
