<html>
<head>
<title>RPi Home Controller</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.css">
<script src="http://code.jquery.com/jquery-1.8.3.min.js"></script>
<script src="http://code.jquery.com/mobile/1.3.2/jquery.mobile-1.3.2.min.js"></script>
<style type="text/css">
.ui-header .ui-title {
    margin-right: 10%;
    margin-left: 10%;
}
</style>
<script type="text/javascript">

function change_switch(switch_name, switch_value) {
    $.ajax({
        url: '/switch/' + switch_name,
        type: 'PUT',
        data: "value="+switch_value,
        success: function(data) {
        }
    });
}

function change_all(on_or_off) {
    $.ajax({
        url: '/all/' + on_or_off,
        type: 'PUT',
        success: function(data) {
            refresh_switch_ui(data);
        }
    });
}

function set_switch_ui_value(switch_ui_id, on_or_off) {
    $(switch_ui_id).val(on_or_off);
    $(switch_ui_id).slider("refresh");
}

function refresh_switch_ui(switch_data) {
    for (var key in switch_data) {
        set_switch_ui_value("#switch"+key, switch_data['switches'][key]);
    }
}

function refresh_switches() {
    $.mobile.showPageLoadingMsg();
    $.get("/switch/list", function(switch_data) {
        for (var key in switch_data) {
            set_switch_ui_value("#switch"+key, switch_data[key]);
        }
        $.mobile.hidePageLoadingMsg()
    });
}

function get_automation_mode() {
    $.mobile.showPageLoadingMsg();
    $.get("/automation_mode/", function(response) {
        $("#automation_mode").val(response["automation_mode"]);
        $("#automation_mode").slider("refresh");
        $.mobile.hidePageLoadingMsg()
    });
}

function change_switch(switch_name, switch_value) {
    $.ajax({
        url: '/switch/' + switch_name,
        type: 'PUT',
        data: "value="+switch_value,
        success: function(data) {
        }
    });
}

function set_automation_mode(automation_mode_value) {
    $.ajax({
        url: '/automation_mode/',
        type: 'PUT',
        data: "value="+automation_mode_value,
        success: function(data) {
            $("#automation_mode").val(on_or_off);
            $("#automation_mode").slider("refresh");
        }
    });
}

$(function() {
    $("#automation_mode").bind("change", function(event, ui) {
        var new_value = $(this).attr('value');
        set_automation_mode(new_value);
    });
    $("#switch1").bind("change", function(event, ui) {
        var new_value = $(this).attr('value');
        change_switch('1', new_value);
    });
    $("#switch2").bind("change", function(event, ui) {
        var new_value = $(this).attr('value');
        change_switch('2', new_value);
    });
    $("#switch3").bind("change", function(event, ui) {
        var new_value = $(this).attr('value');
        change_switch('3', new_value);
    });

    refresh_switches();
    get_automation_mode();
});


</script>
</head>
<body>

<div data-role="page">
    <div data-role="header" data-position="fixed">
        <h2>RPi Home Controller</h2>
        <a href="#" rel="external" onclick="refresh_switches(); return false" id="refresh_button" data-role="button" data-icon="refresh" class="ui-btn-right" data-iconpos="notext">Refresh</a>
    </div>

    <div data-role="content">
        <div data-role="fieldcontain">
            <label for="automation_mode">Alarm Mode</label>
            <select name="automation_mode" id="automation_mode" data-role="slider">
            <option value="off">Off</option>
            <option value="on">On</option>
            </select>
        </div>
        <div data-role="fieldcontain">
            <label for="switch1">Switch 1</label>
            <select name="switch1" id="switch1" data-role="slider">
            <option value="off">Off</option>
            <option value="on">On</option>
            </select>
        </div>
        <div data-role="fieldcontain">
            <label for="switch2">Switch 2</label>
            <select name="switch2" id="switch2" data-role="slider">
            <option value="off">Off</option>
            <option value="on">On</option>
            </select>
        </div>
        <div data-role="fieldcontain">
            <label for="switch3">Switch 3</label>
            <select name="switch3" id="switch3" data-role="slider">
            <option value="off">Off</option>
            <option value="on">On</option>
            </select>
        </div>
        <div data-role="fieldcontain">
            <button data-inline="true" onclick="change_all('off'); return false;">All Off</button>
            <button data-inline="true" data-theme="b" onclick="change_all('on'); return false;">All On</button>
        </div>
    </div>

    <div data-role="footer" data-position="fixed">&nbsp;</div>
</div>

</body>
</html>
